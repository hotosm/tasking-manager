<div class="inner">
    <section class="section section--asided">
        <header class="section__header">
            <div class="inner">
                <h1 class="section__title">
                    Activity and Stats
                </h1>
                <a ng-href="/project/{{ projectDashboardCtrl.project.id }}"
                   class="heading-alt">{{ projectDashboardCtrl.project.name }}
                </a>
            </div>
        </header>
        <div class="section-container">
            <div class="section__body">
                <div class="inner">
                    <div class="dashboard-container">
                        <div class="left">
                            <h2>Last activity</h2>
                            <p ng-show="!projectDashboardCtrl.projectActivity.length > 0">No activity (yet).</p>
                            <div ng-show="projectDashboardCtrl.projectActivity.length > 0">
                                <div class="content">
                                    <div ng-repeat="item in projectDashboardCtrl.projectActivity">
                                        <span ng-show="item.action === 'LOCKED_FOR_MAPPING'">Task locked for mapping by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'LOCKED_FOR_VALIDATION'">Task locked for validation by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'STATE_CHANGE' && item.actionText === 'BADIMAGERY'">Task marked as bad imagery by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'STATE_CHANGE' && item.actionText === 'MAPPED'">Task mapped by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'STATE_CHANGE' && item.actionText === 'VALIDATED'">Task validated by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'STATE_CHANGE' && item.actionText === 'INVALIDATED'">Task invalidated by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <span ng-show="item.action === 'STATE_CHANGE' && item.actionText === 'READY'">Task marked as ready by <a
                                                href="/user/{{ item.actionBy }}">{{ item.actionBy }}</a></span>
                                        <p>
                                            <em am-time-ago="item.actionDate | amUtc | amLocal"></em>
                                        </p>
                                    </div>
                                </div>
                                <button class="button button--achromic"
                                    ng-class="!projectDashboardCtrl.projectActivityPagination.hasPrev ? 'disabled' : ''"
                                    ng-click="projectDashboardCtrl.getLastActivity(projectDashboardCtrl.projectActivityPagination.prevNum)">
                                    Newer
                                </button>
                                <button class="button button--achromic"
                                    ng-class="!projectDashboardCtrl.projectActivityPagination.hasNext ? 'disabled' : ''"
                                    ng-click="projectDashboardCtrl.getLastActivity(projectDashboardCtrl.projectActivityPagination.nextNum)">
                                    Older
                                </button>
                            </div>
                        </div>
                        <div class="right">
                            <h2>Contributions</h2>
                            <div class="content">
                                <p ng-show="!projectDashboardCtrl.projectContributions.length > 0">No contributions (yet).</p>
                                <table ng-show="projectDashboardCtrl.projectContributions.length > 0" class="table table-dashboard-comments">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Mapped</th>
                                            <th>Validated</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in projectDashboardCtrl.projectContributions | orderBy: '-mapped'">
                                            <td><a ng-href="/user/{{ item.username }}">{{ item.username }}</a></td>
                                            <td>{{ item.mapped }}</td>
                                            <td>{{ item.validated }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-container">
            <div class="section__body">
                <div class="inner">
                    <div class="dashboard-container">
                        <h2>Stats</h2>
                        <div class="left">
                            <div class="section__project-dashboard--stats">
                                <span class="label">{{ projectDashboardCtrl.project.percentMapped }}% mapped</span>
                                <uib-progressbar value="projectDashboardCtrl.project.percentMapped"></uib-progressbar>
                                <span class="label">{{ projectDashboardCtrl.project.percentValidated }}% validated</span>
                                <uib-progressbar value="projectDashboardCtrl.project.percentValidated"></uib-progressbar>
                            </div>
                        </div>
                        <div class="right">
                            <div id="map" class="map-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-container">
            <div class="section__body">
                <div class="inner">
                    <h2>Comments by users</h2>
                      <h6 class="heading-alt">{{ projectDashboardCtrl.selectedProject.name }}</h6>
                    <div ng-show="projectDashboardCtrl.projectComments.length < 1">
                        No comments (yet).
                    </div>
                    <div ng-show="projectDashboardCtrl.projectComments.length > 0">
                        <table class="table table-dashboard-comments">
                            <thead>
                                <tr>
                                    <th>Comment</th>
                                    <th>When</th>
                                    <th>By</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="comment in projectDashboardCtrl.projectComments | orderBy: '-commentDate'">
                                    <td>{{ comment.comment }}</td>
                                    <td><span am-time-ago="comment.commentDate | amUtc | amLocal"></span></td>
                                    <td><a href="/user/{{ comment.userName }}" target="_blank">{{ comment.userName }}</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>