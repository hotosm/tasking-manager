<div class="inner">
    <section class="section section--asided">
        <header class="section__header">
            <div class="inner">
                <h1 class="section__title">
                    User profile
                </h1>
            </div>
        </header>
        <div class="section-container">
            <div class="section__body">
                <div class="inner">
                    <div class="profile-container">
                        <div class="details">
                            <h1>{{ profileCtrl.username }}</h1>
                            <p ng-show="profileCtrl.userDetails.mappingLevel === 'BEGINNER'">Beginner mapper</p>
                            <p ng-show="profileCtrl.userDetails.mappingLevel === 'INTERMEDIATE'">Intermediate mapper</p>
                            <p ng-show="profileCtrl.userDetails.mappingLevel === 'ADVANCED'">Advanced mapper</p>
                            <div ng-show="profileCtrl.osmUserDetails">
                                <p>Joined OSM <span am-time-ago="profileCtrl.osmUserDetails.accountCreated | amUtc | amLocal"></span></p>
                                <p>{{ profileCtrl.osmUserDetails.changesetCount}} total OSM changesets</p>
                            </div>
                            <p>
                                <a href="http://www.openstreetmap.org/user/{{ profileCtrl.username }}" target="_blank">
                                    OSM profile
                                </a>
                            </p>
                            <p>
                                <a href="http://www.openstreetmap.org/user/{{ profileCtrl.username }}/history" target="_blank">
                                    OSM edit history
                                </a>
                            </p>
                            <hr ng-show="profileCtrl.userDetails.emailAddress || profileCtrl.userDetails.facebookId || profileCtrl.userDetails.twitterId || profileCtrl.userDetails.linkedinId"/>
                            <p>
                                <span ng-show="profileCtrl.userDetails.emailAddress || profileCtrl.editDetails">Email (only visible to you):</span>
                                <span ng-hide="profileCtrl.editDetails">
                                    {{ profileCtrl.userDetails.emailAddress }}
                                </span>
                                <input ng-show="profileCtrl.editDetails" type="text" size="30"
                                       class="form__control form__control__inline"
                                       placeholder="Email"
                                       ng-model="profileCtrl.userDetails.emailAddress" />
                            </p>
                            <p>
                                <span ng-show="profileCtrl.userDetails.facebookId || profileCtrl.editDetails">Facebook:</span>
                                <a ng-hide="profileCtrl.editDetails" href="http://www.facebook.com/{{ profileCtrl.userDetails.facebookId }}" target="_blank">
                                    {{ profileCtrl.userDetails.facebookId }}
                                </a>
                                <input ng-show="profileCtrl.editDetails" type="text" size="30"
                                       class="form__control form__control__inline"
                                       placeholder="Facebook ID (e.g. hotosm)"
                                       ng-model="profileCtrl.userDetails.facebookId" />
                            </p>
                            <p>
                                <span ng-show="profileCtrl.userDetails.twitterId || profileCtrl.editDetails">Twitter:</span>
                                <a ng-hide="profileCtrl.editDetails" href="http://www.twitter.com/{{ profileCtrl.userDetails.twitterId }}" target="_blank">
                                    {{ profileCtrl.userDetails.twitterId }}
                                </a>
                                <input ng-show="profileCtrl.editDetails" type="text" size="30"
                                       class="form__control form__control__inline"
                                       placeholder="Twitter ID (e.g. hotosm)"
                                       ng-model="profileCtrl.userDetails.twitterId" />
                            </p>
                            <p>
                                <span ng-show="profileCtrl.userDetails.linkedinId || profileCtrl.editDetails">LinkedIn:</span>
                                <a ng-hide="profileCtrl.editDetails" href="http://www.linkedin.com/in{{ profileCtrl.userDetails.linkedinId }}" target="_blank">
                                    {{ profileCtrl.userDetails.linkedinId }}
                                </a>
                                <input ng-show="profileCtrl.editDetails" type="text" size="30"
                                       class="form__control form__control__inline"
                                       placeholder="LinkedIn ID (personal)"
                                       ng-model="profileCtrl.userDetails.linkedinId" />
                            </p>
                            <p ng-show="profileCtrl.userDetails.username === profileCtrl.currentlyLoggedInUser.username">
                                <button class="button button--achromic" type="button" ng-click="profileCtrl.editDetails = !profileCtrl.editDetails" ng-show="!profileCtrl.editDetails">
                                    <i class="hot-ds-icon-pencil" title="Edit Twitter URL"></i>
                                    <span>Add/edit contact details</span>
                                </button>
                                <button class="button button--achromic" type="button" ng-click="profileCtrl.setContactDetails()" ng-show="profileCtrl.editDetails">
                                    <i class="hot-ds-icon-tick" title="Save edits"></i>
                                    <span>Save</span>
                                </button>
                                <button class="button button--achromic" type="button" ng-click="profileCtrl.editDetails = false" ng-show="profileCtrl.editDetails">
                                    <i class="hot-ds-icon-xmark" title="Cancel edits"></i>
                                    <span>Cancel</span>
                                </button>
                                <p ng-show="profileCtrl.errorSetContactDetails" class="error">An error occurred when setting your contact details.</p>
                            </p>
                        </div>
                        <div class="roles pull-right">
                            <div>
                                <!-- User's own profile -->
                                <div ng-show="profileCtrl.userDetails.username === profileCtrl.currentlyLoggedInUser.username">
                                    <h4 ng-show="profileCtrl.userDetails.role === 'VALIDATOR'">
                                        <i class="hot-ds-icon-circle-tick"></i> Validator
                                    </h4>
                                    <h4 ng-show="profileCtrl.userDetails.role === 'PROJECT_MANAGER'">
                                        <i class="hot-ds-icon-pencil"></i> Project Manager
                                    </h4>
                                    <h4 ng-show="profileCtrl.userDetails.role === 'ADMIN'">
                                        <i class="hot-ds-icon-pencil"></i> Administrator
                                    </h4>
                                </div>
                                <!-- Someone else's profile -->
                                <div ng-hide="profileCtrl.userDetails.username === profileCtrl.currentlyLoggedInUser.username">
                                    <h3 ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'">
                                        Set role
                                    </h3>
                                    <h4 ng-show="profileCtrl.userDetails.role === 'VALIDATOR'">
                                        <i class="hot-ds-icon-circle-tick"></i> Validator
                                        <button class="button button--achromic"
                                                ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                                ng-click="profileCtrl.setRole('MAPPER')">Remove privileges
                                        </button>
                                    </h4>
                                    <h4 ng-show="profileCtrl.userDetails.role === 'PROJECT_MANAGER'">
                                        <i class="hot-ds-icon-pencil"></i> Project Manager
                                        <button class="button button--achromic"
                                                ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                                ng-click="profileCtrl.setRole('MAPPER')">Remove privileges
                                        </button>
                                    </h4>
                                    <h4 ng-show="profileCtrl.userDetails.role === 'ADMIN'">
                                        <i class="hot-ds-icon-pencil"></i> Administrator
                                        <button class="button button--achromic"
                                                ng-show="profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                                ng-click="profileCtrl.setRole('MAPPER')">Remove privileges
                                        </button>
                                    </h4>
                                    <button class="button button--achromic"
                                            ng-show="profileCtrl.userDetails.role != 'PROJECT_MANAGER' && (profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN')"
                                            ng-click="profileCtrl.setRole('PROJECT_MANAGER')">Set as project manager
                                    </button>
                                    <button class="button button--achromic"
                                            ng-show="profileCtrl.userDetails.role != 'VALIDATOR' && (profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN')"
                                            ng-click="profileCtrl.setRole('VALIDATOR')">Set as validator
                                    </button>
                                    <button class="button button--achromic"
                                            ng-show="profileCtrl.userDetails.role != 'ADMIN' && profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                            ng-click="profileCtrl.setRole('ADMIN')">Set as administrator
                                    </button>
                                </div>
                                <p ng-show="profileCtrl.errorSetRole" class="error">An error occurred when setting the role.</p>
                            </div>
                            <div ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'">
                                <h3>Set mapper level</h3>
                                <p>Manually set a user's mapper level.</p>
                                <div class="button-group button-group--horizontal" role="group" aria-label="set mapper level">
                                    <button class="button button--achromic"
                                            ng-class="profileCtrl.userDetails.mappingLevel === 'BEGINNER'? 'button--active' : ''"
                                            ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                            ng-click="profileCtrl.setLevel('BEGINNER')">Beginner
                                    </button>
                                    <button class="button button--achromic"
                                            ng-class="profileCtrl.userDetails.mappingLevel === 'INTERMEDIATE'? 'button--active' : ''"
                                            ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                            ng-click="profileCtrl.setLevel('INTERMEDIATE')">Intermediate
                                    </button>
                                    <button class="button button--achromic"
                                            ng-class="profileCtrl.userDetails.mappingLevel === 'ADVANCED'? 'button--active' : ''"
                                            ng-show="profileCtrl.currentlyLoggedInUser.role === 'PROJECT_MANAGER' || profileCtrl.currentlyLoggedInUser.role === 'ADMIN'"
                                            ng-click="profileCtrl.setLevel('ADVANCED')">Advanced
                                    </button>
                                    <p ng-show="profileCtrl.errorSetLevel" class="error">An error occurred when setting the level.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-container">
            <div class="section__inverse--stats">
                <div class="stats__card">
                    <div class="stats__card--amount"><strong>{{ profileCtrl.userDetails.tasksMapped }}</strong></div>
                    <div class="stats__card--title">tasks mapped</div>
                </div>
                <div class="stats__card">
                    <div class="stats__card--amount"><strong>{{ profileCtrl.userDetails.tasksValidated }}</strong></div>
                    <div class="stats__card--title">tasks validated</div>
                </div>
            </div>
        </div>
        <div class="section-container">
            <div class="section__body">
                <div class="inner">
                    <h2>Projects</h2>
                     <p ng-show="!profileCtrl.projects.length > 0">No contributions to projects (yet).</p>
                    <div ng-show="profileCtrl.projects.length > 0" class="profile-projects-list">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Project name</th>
                                <th>Number of tasks mapped</th>
                                <th>Number of tasks validated</th>
                                <th>Status</th>
                                <th>Overpass</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="project in profileCtrl.projects">
                                <td>{{ project.projectId }}</td>
                                <td><a ng-href="project/{{ project.projectId }}">{{ project.name }}</a></td>
                                <td>{{ project.tasksMapped }}</td>
                                <td>{{ project.tasksValidated }}</td>
                                <td>{{ project.status }}</td>
                                <td><a href="" ng-click="profileCtrl.viewOverpassTurbo(project.aoi)">View in Overpass Turbo</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <div id="map" class="map-container"></div>
                        <div id="popup" class="ol-popup">
                            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                            <div id="popup-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>