<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tasking Manager: backend.services.users.authentication_service.AuthenticationService Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tasking Manager
   </div>
   <div id="projectbrief">Tasking Manager backend</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>backend</b></li><li class="navelem"><b>services</b></li><li class="navelem"><b>users</b></li><li class="navelem"><b>authentication_service</b></li><li class="navelem"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html">AuthenticationService</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">backend.services.users.authentication_service.AuthenticationService Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for backend.services.users.authentication_service.AuthenticationService:</div>
<div class="dyncontent">
<div class="center"><img src="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService__coll__graph.png" border="0" usemap="#abackend_8services_8users_8authentication__service_8AuthenticationService_coll__map" alt="Collaboration graph"/></div>
<map name="abackend_8services_8users_8authentication__service_8AuthenticationService_coll__map" id="abackend_8services_8users_8authentication__service_8AuthenticationService_coll__map">
<area shape="rect" title=" " alt="" coords="5,5,268,264"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:abcd3de4879cd6473c0bb0707aadca0a6" id="r_abcd3de4879cd6473c0bb0707aadca0a6"><td class="memItemLeft" align="right" valign="top">dict&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#abcd3de4879cd6473c0bb0707aadca0a6">login_user</a> (osm_user_details, email, db, user_element=&quot;user&quot;)</td></tr>
<tr class="separator:abcd3de4879cd6473c0bb0707aadca0a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae10290cc31b27f279fcc23b2576a4c08" id="r_ae10290cc31b27f279fcc23b2576a4c08"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#ae10290cc31b27f279fcc23b2576a4c08">authenticate_email_token</a> (str username, str token, Database db)</td></tr>
<tr class="separator:ae10290cc31b27f279fcc23b2576a4c08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61e08922d8e38312e0b7d80ac1d70de0" id="r_a61e08922d8e38312e0b7d80ac1d70de0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#a61e08922d8e38312e0b7d80ac1d70de0">get_authentication_failed_url</a> ()</td></tr>
<tr class="separator:a61e08922d8e38312e0b7d80ac1d70de0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef4af1661a692fbede77f3a4ced2657b" id="r_aef4af1661a692fbede77f3a4ced2657b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#aef4af1661a692fbede77f3a4ced2657b">generate_session_token_for_user</a> (int osm_id)</td></tr>
<tr class="separator:aef4af1661a692fbede77f3a4ced2657b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06496114e62d3084933bacd75b3c89f2" id="r_a06496114e62d3084933bacd75b3c89f2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#a06496114e62d3084933bacd75b3c89f2">generate_random_state</a> (length=48, chars=UNICODE_ASCII_CHARACTER_SET)</td></tr>
<tr class="separator:a06496114e62d3084933bacd75b3c89f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2da655ec3c4201458ef508963cf66978" id="r_a2da655ec3c4201458ef508963cf66978"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#a2da655ec3c4201458ef508963cf66978">is_valid_token</a> (token, token_expiry)</td></tr>
<tr class="separator:a2da655ec3c4201458ef508963cf66978"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a9d85f2b7c83de49cfa215c8a04ddeb67" id="r_a9d85f2b7c83de49cfa215c8a04ddeb67"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbackend_1_1services_1_1users_1_1authentication__service_1_1AuthenticationService.html#a9d85f2b7c83de49cfa215c8a04ddeb67">_get_email_validated_url</a> (bool is_valid)</td></tr>
<tr class="separator:a9d85f2b7c83de49cfa215c8a04ddeb67"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00105">105</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a9d85f2b7c83de49cfa215c8a04ddeb67" name="a9d85f2b7c83de49cfa215c8a04ddeb67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d85f2b7c83de49cfa215c8a04ddeb67">&#9670;&#160;</a></span>_get_email_validated_url()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"> str backend.services.users.authentication_service.AuthenticationService._get_email_validated_url </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_valid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Helper function to generate redirect url for email verification</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00170">170</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="ae10290cc31b27f279fcc23b2576a4c08" name="ae10290cc31b27f279fcc23b2576a4c08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae10290cc31b27f279fcc23b2576a4c08">&#9670;&#160;</a></span>authenticate_email_token()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">backend.services.users.authentication_service.AuthenticationService.authenticate_email_token </td>
          <td>(</td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Database&#160;</td>
          <td class="paramname"><em>db</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Validate that the email token is valid</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00151">151</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="a06496114e62d3084933bacd75b3c89f2" name="a06496114e62d3084933bacd75b3c89f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06496114e62d3084933bacd75b3c89f2">&#9670;&#160;</a></span>generate_random_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">backend.services.users.authentication_service.AuthenticationService.generate_random_state </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>length</em> = <code>48</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>chars</em> = <code>UNICODE_ASCII_CHARACTER_SET</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Generates a non-guessable OAuth token
OAuth (1 and 2) does not specify the format of tokens except that they
should be strings of random characters. Tokens should not be guessable
and entropy when generating the random characters is important. Which is
why SystemRandom is used instead of the default random.choice method.
</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00201">201</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="aef4af1661a692fbede77f3a4ced2657b" name="aef4af1661a692fbede77f3a4ced2657b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef4af1661a692fbede77f3a4ced2657b">&#9670;&#160;</a></span>generate_session_token_for_user()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">backend.services.users.authentication_service.AuthenticationService.generate_session_token_for_user </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>osm_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Generates a unique token with the osm_id and current time embedded within it
:param osm_id: OSM ID of the user authenticating
:return: Token
</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00188">188</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="a61e08922d8e38312e0b7d80ac1d70de0" name="a61e08922d8e38312e0b7d80ac1d70de0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61e08922d8e38312e0b7d80ac1d70de0">&#9670;&#160;</a></span>get_authentication_failed_url()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">backend.services.users.authentication_service.AuthenticationService.get_authentication_failed_url </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Generates the auth-failed URL for the running app</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00181">181</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="a2da655ec3c4201458ef508963cf66978" name="a2da655ec3c4201458ef508963cf66978"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2da655ec3c4201458ef508963cf66978">&#9670;&#160;</a></span>is_valid_token()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">backend.services.users.authentication_service.AuthenticationService.is_valid_token </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>token_expiry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Validates if the supplied token is valid, and hasn't expired.
:param token: Token to check
:param token_expiry: When the token expires in seconds
:return: True if token is valid, and user_id contained in token
</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00212">212</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<a id="abcd3de4879cd6473c0bb0707aadca0a6" name="abcd3de4879cd6473c0bb0707aadca0a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcd3de4879cd6473c0bb0707aadca0a6">&#9670;&#160;</a></span>login_user()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"> dict backend.services.users.authentication_service.AuthenticationService.login_user </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>osm_user_details</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>user_element</em> = <code>&quot;user&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Generates authentication details for user, creating in DB if user is unknown to us
:param osm_user_details: XML response from OSM
:param redirect_to: Route to redirect user to, from callback url
:param user_element: Exists for unit testing
:raises AuthServiceError
:returns A dictionary containing the keys "username", "session_token"
and "picture."
</pre> 
<p class="definition">Definition at line <a class="el" href="authentication__service_8py_source.html#l00107">107</a> of file <a class="el" href="authentication__service_8py_source.html">authentication_service.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/runner/work/tasking-manager/tasking-manager/backend/services/users/<a class="el" href="authentication__service_8py_source.html">authentication_service.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
