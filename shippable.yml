# language setting
language: python

# version numbers
python:
    - "3.5"

build:
    # Use the python 3.6 docker container to build the application
    pre_ci_boot:
        image_name: python
        image_tag: 3.6
        pull: true
        options: "-e HOME=/root --privileged=True"

    ci:
        # Install latest LTS node
        - apt-get update
        - curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
        - apt-get install nodejs
        - node --version

        # Install NPM packages and build client from gulpfile
        - cd client
        - npm install
        - ./node_modules/.bin/gulp build

        - cd ..
        - python --version
        - python -m venv ./venv_aws
        - . ./venv_aws/bin/activate
        - pip install -r requirements.aws.txt


    on_success:
        # Run deploy script to manage deploy to appropriate environment
        - . ./bin/linux/deploy.sh