import unittest
from server.services.grid_service import GridService
from shapely.geometry import shape
from server.models.dtos.grid_dto import GridDTO
import geojson


class TestGridService(unittest.TestCase):

    def test_trim_grid_to_aoi_noclip_clip(self):
        # arrange
        grid_json = {
            "clipToAoi": True,
            "areaOfInterest": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [
                                11.454777166054331,
                                24.621395460265262
                            ],
                            [
                                11.460956975624642,
                                24.621317433227347
                            ],
                            [
                                11.461901113197886,
                                24.617181930534727
                            ],
                            [
                                11.453661367104136,
                                24.617025871151228
                            ],
                            [
                                11.454777166054331,
                                24.621395460265262
                            ]
                        ]
                    ]
                ]
            },
            "grid": {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.61456036067679
                                        ],
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ],
                                        [
                                            11.453247068260938,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ],
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ],
                                        [
                                            11.453247068260938,
                                            24.622051139078053
                                        ],
                                        [
                                            11.455993650291683,
                                            24.622051139078053
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ],
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.622051139078053
                                        ],
                                        [
                                            11.45874023232243,
                                            24.622051139078053
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ],
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.622051139078053
                                        ],
                                        [
                                            11.461486814353208,
                                            24.622051139078053
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.464233396383955,
                                            24.617057336671365
                                        ],
                                        [
                                            11.464233396383955,
                                            24.61456036067679
                                        ],
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.464233396383955,
                                            24.619554262806403
                                        ],
                                        [
                                            11.464233396383955,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.622051139078053
                                        ],
                                        [
                                            11.464233396383955,
                                            24.622051139078053
                                        ],
                                        [
                                            11.464233396383955,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74789,
                            "zoom": 17
                        }
                    }
                ]
            }
        }
        grid_dto = GridDTO(grid_json)
        expected =  geojson.FeatureCollection([{"geometry": {"coordinates": [[[[11.455322708388653, 24.617057336671365], [11.453661367104136, 24.617025871151228], [11.453669402000191, 24.617057336671365], [11.455322708388653, 24.617057336671365]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69706, "y": 74787, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.455993650291683, 24.6170700441964], [11.455322708388653, 24.617057336671365], [11.453669402000191, 24.617057336671365], [11.454307006014547, 24.619554262806403], [11.455993650291683, 24.619554262806403], [11.455993650291683, 24.6170700441964]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69706, "y": 74788, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.454777166054331, 24.621395460265262], [11.455993650291683, 24.621380100785228], [11.455993650291683, 24.619554262806403], [11.454307006014547, 24.619554262806403], [11.454777166054331, 24.621395460265262]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69706, "y": 74789, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.45874023232243, 24.617122063990887], [11.455993650291683, 24.6170700441964], [11.455993650291683, 24.619554262806403], [11.45874023232243, 24.619554262806403], [11.45874023232243, 24.617122063990887]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69707, "y": 74788, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.455993650291683, 24.621380100785228], [11.45874023232243, 24.621345422101715], [11.45874023232243, 24.619554262806403], [11.455993650291683, 24.619554262806403], [11.455993650291683, 24.621380100785228]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69707, "y": 74789, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.46135950841598, 24.619554262806403], [11.461486814353208, 24.61899663851402], [11.461486814353208, 24.61717408378538], [11.45874023232243, 24.617122063990887], [11.45874023232243, 24.619554262806403], [11.46135950841598, 24.619554262806403]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69708, "y": 74788, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.45874023232243, 24.621345422101715], [11.460956975624642, 24.621317433227347], [11.46135950841598, 24.619554262806403], [11.45874023232243, 24.619554262806403], [11.45874023232243, 24.621345422101715]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69708, "y": 74789, "zoom": 17}, "type": "Feature"}, {"geometry": {"coordinates": [[[[11.461486814353208, 24.61899663851402], [11.461901113197886, 24.617181930534727], [11.461486814353208, 24.61717408378538], [11.461486814353208, 24.61899663851402]]]], "type": "MultiPolygon"}, "properties": {"splittable": False, "x": 69709, "y": 74788, "zoom": 17}, "type": "Feature"}])

        # act
        grid = GridService.trim_grid_to_aoi(grid_dto)
        print(grid)
        print(expected)
        # assert
        self.assertEquals(grid, expected)

    def test_trim_grid_to_aoi_noclip(self):
        # arrange

        grid_json = {
            "clipToAoi": False,
            "areaOfInterest": {
                "type": "MultiPolygon",
                "coordinates": [
                    [
                        [
                            [
                                11.454777166054331,
                                24.621395460265262
                            ],
                            [
                                11.460956975624642,
                                24.621317433227347
                            ],
                            [
                                11.461901113197886,
                                24.617181930534727
                            ],
                            [
                                11.453661367104136,
                                24.617025871151228
                            ],
                            [
                                11.454777166054331,
                                24.621395460265262
                            ]
                        ]
                    ]
                ]
            },
            "grid": {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.61456036067679
                                        ],
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ],
                                        [
                                            11.453247068260938,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ],
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.453247068260938,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ],
                                        [
                                            11.453247068260938,
                                            24.622051139078053
                                        ],
                                        [
                                            11.455993650291683,
                                            24.622051139078053
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.453247068260938,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69706,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ],
                                        [
                                            11.455993650291683,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.455993650291683,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.622051139078053
                                        ],
                                        [
                                            11.45874023232243,
                                            24.622051139078053
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.455993650291683,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69707,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ],
                                        [
                                            11.45874023232243,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.45874023232243,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.622051139078053
                                        ],
                                        [
                                            11.461486814353208,
                                            24.622051139078053
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.45874023232243,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69708,
                            "y": 74789,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.464233396383955,
                                            24.617057336671365
                                        ],
                                        [
                                            11.464233396383955,
                                            24.61456036067679
                                        ],
                                        [
                                            11.461486814353208,
                                            24.61456036067679
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74787,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.464233396383955,
                                            24.619554262806403
                                        ],
                                        [
                                            11.464233396383955,
                                            24.617057336671365
                                        ],
                                        [
                                            11.461486814353208,
                                            24.617057336671365
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74788,
                            "zoom": 17
                        }
                    },
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "MultiPolygon",
                            "coordinates": [
                                [
                                    [
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.622051139078053
                                        ],
                                        [
                                            11.464233396383955,
                                            24.622051139078053
                                        ],
                                        [
                                            11.464233396383955,
                                            24.619554262806403
                                        ],
                                        [
                                            11.461486814353208,
                                            24.619554262806403
                                        ]
                                    ]
                                ]
                            ]
                        },
                        "properties": {
                            "x": 69709,
                            "y": 74789,
                            "zoom": 17
                        }
                    }
                ]
            }
        }
        grid_dto = GridDTO(grid_json)

        expected = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.453247068260938,
                                        24.61456036067679
                                    ],
                                    [
                                        11.453247068260938,
                                        24.617057336671365
                                    ],
                                    [
                                        11.455993650291683,
                                        24.617057336671365
                                    ],
                                    [
                                        11.455993650291683,
                                        24.61456036067679
                                    ],
                                    [
                                        11.453247068260938,
                                        24.61456036067679
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69706,
                        "y": 74787,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.453247068260938,
                                        24.617057336671365
                                    ],
                                    [
                                        11.453247068260938,
                                        24.619554262806403
                                    ],
                                    [
                                        11.455993650291683,
                                        24.619554262806403
                                    ],
                                    [
                                        11.455993650291683,
                                        24.617057336671365
                                    ],
                                    [
                                        11.453247068260938,
                                        24.617057336671365
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69706,
                        "y": 74788,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.453247068260938,
                                        24.619554262806403
                                    ],
                                    [
                                        11.453247068260938,
                                        24.622051139078053
                                    ],
                                    [
                                        11.455993650291683,
                                        24.622051139078053
                                    ],
                                    [
                                        11.455993650291683,
                                        24.619554262806403
                                    ],
                                    [
                                        11.453247068260938,
                                        24.619554262806403
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69706,
                        "y": 74789,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.455993650291683,
                                        24.617057336671365
                                    ],
                                    [
                                        11.455993650291683,
                                        24.619554262806403
                                    ],
                                    [
                                        11.45874023232243,
                                        24.619554262806403
                                    ],
                                    [
                                        11.45874023232243,
                                        24.617057336671365
                                    ],
                                    [
                                        11.455993650291683,
                                        24.617057336671365
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69707,
                        "y": 74788,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.455993650291683,
                                        24.619554262806403
                                    ],
                                    [
                                        11.455993650291683,
                                        24.622051139078053
                                    ],
                                    [
                                        11.45874023232243,
                                        24.622051139078053
                                    ],
                                    [
                                        11.45874023232243,
                                        24.619554262806403
                                    ],
                                    [
                                        11.455993650291683,
                                        24.619554262806403
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69707,
                        "y": 74789,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.45874023232243,
                                        24.617057336671365
                                    ],
                                    [
                                        11.45874023232243,
                                        24.619554262806403
                                    ],
                                    [
                                        11.461486814353208,
                                        24.619554262806403
                                    ],
                                    [
                                        11.461486814353208,
                                        24.617057336671365
                                    ],
                                    [
                                        11.45874023232243,
                                        24.617057336671365
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69708,
                        "y": 74788,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.45874023232243,
                                        24.619554262806403
                                    ],
                                    [
                                        11.45874023232243,
                                        24.622051139078053
                                    ],
                                    [
                                        11.461486814353208,
                                        24.622051139078053
                                    ],
                                    [
                                        11.461486814353208,
                                        24.619554262806403
                                    ],
                                    [
                                        11.45874023232243,
                                        24.619554262806403
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69708,
                        "y": 74789,
                        "zoom": 17
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "MultiPolygon",
                        "coordinates": [
                            [
                                [
                                    [
                                        11.461486814353208,
                                        24.617057336671365
                                    ],
                                    [
                                        11.461486814353208,
                                        24.619554262806403
                                    ],
                                    [
                                        11.464233396383955,
                                        24.619554262806403
                                    ],
                                    [
                                        11.464233396383955,
                                        24.617057336671365
                                    ],
                                    [
                                        11.461486814353208,
                                        24.617057336671365
                                    ]
                                ]
                            ]
                        ]
                    },
                    "properties": {
                        "x": 69709,
                        "y": 74788,
                        "zoom": 17
                    }
                }
            ]
        }

        # act
        grid = GridService.trim_grid_to_aoi(grid_dto)
        # assert
        self.assertEquals(grid, expected)
